!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["p5.mapper"]=e():t["p5.mapper"]=e()}(self,(function(){return(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);var n={dim:function(t){var i;return"object"===e(t)?"object"===e(i=t[0])?"object"===e(i[0])?n._dim(t):[t.length,i.length]:[t.length]:[]},_foreach2:function t(e,n,i,r){if(i===n.length-1)return r(e);var o,s=n[i],a=Array(s);for(o=s-1;o>=0;o--)a[o]=t(e[o],n,i+1,r);return a},cloneV:function(t){var e,n=t.length,i=Array(n);for(e=n-1;-1!==e;--e)i[e]=t[e];return i},clone:function(t){if("object"!==e(t))return t;var i=n.cloneV,r=n.dim(t);return n._foreach2(t,r,0,i)},diag:function(t){var e,n,i,r,o=t.length,s=Array(o);for(e=o-1;e>=0;e--){for(r=Array(o),n=e+2,i=o-1;i>=n;i-=2)r[i]=0,r[i-1]=0;for(i>e&&(r[i]=0),r[e]=t[e],i=e-1;i>=1;i-=2)r[i]=0,r[i-1]=0;0===i&&(r[0]=0),s[e]=r}return s},rep:function(t,e,i){void 0===i&&(i=0);var r,o=t[i],s=Array(o);if(i===t.length-1){for(r=o-2;r>=0;r-=2)s[r+1]=e,s[r]=e;return-1===r&&(s[0]=e),s}for(r=o-1;r>=0;r--)s[r]=n.rep(t,e,i+1);return s},identity:function(t){return n.diag(n.rep([t],1))},inv:function(t){var e,i,r,o,s,a,h,l,u=n.dim(t),c=Math.abs,f=u[0],y=u[1],p=n.clone(t),v=n.identity(f);for(a=0;a<y;++a){var d=-1,m=-1;for(s=a;s!==f;++s)(h=c(p[s][a]))>m&&(d=s,m=h);for(i=p[d],p[d]=p[a],p[a]=i,o=v[d],v[d]=v[a],v[a]=o,l=i[a],h=a;h!==y;++h)i[h]/=l;for(h=y-1;-1!==h;--h)o[h]/=l;for(s=f-1;-1!==s;--s)if(s!==a){for(e=p[s],r=v[s],l=e[a],h=a+1;h!==y;++h)e[h]-=i[h]*l;for(h=y-1;h>0;--h)r[h]-=o[h]*l,r[--h]-=o[h]*l;0===h&&(r[0]-=o[0]*l)}}return v},dotMMsmall:function(t,e){var n,i,r,o,s,a,h,l,u,c,f;for(o=t.length,s=e.length,a=e[0].length,h=Array(o),n=o-1;n>=0;n--){for(l=Array(a),u=t[n],r=a-1;r>=0;r--){for(c=u[s-1]*e[s-1][r],i=s-2;i>=1;i-=2)f=i-1,c+=u[i]*e[i][r]+u[f]*e[f][r];0===i&&(c+=u[0]*e[0][r]),l[r]=c}h[n]=l}return h},dotMV:function(t,e){var i,r=t.length,o=Array(r),s=n.dotVV;for(i=r-1;i>=0;i--)o[i]=s(t[i],e);return o},dotVV:function(t,e){var n,i,r=t.length,o=t[r-1]*e[r-1];for(n=r-2;n>=1;n-=2)i=n-1,o+=t[n]*e[n]+t[i]*e[i];return 0===n&&(o+=t[0]*e[0]),o},transpose:function(t){var e,n,i,r,o,s=t.length,a=t[0].length,h=Array(a);for(n=0;n<a;n++)h[n]=Array(s);for(e=s-1;e>=1;e-=2){for(r=t[e],i=t[e-1],n=a-1;n>=1;--n)(o=h[n])[e]=r[n],o[e-1]=i[n],(o=h[--n])[e]=r[n],o[e-1]=i[n];0===n&&((o=h[0])[e]=r[0],o[e-1]=i[0])}if(0===e){for(i=t[0],n=a-1;n>=1;--n)h[n][0]=i[n],h[--n][0]=i[n];0===n&&(h[0][0]=i[0])}return h}};const i=n;function r(t,e,n){if(n){var r=e;e=t,t=r}var o,s=[[t[0],t[1],1,0,0,0,-1*e[0]*t[0],-1*e[0]*t[1]],[0,0,0,t[0],t[1],1,-1*e[1]*t[0],-1*e[1]*t[1]],[t[2],t[3],1,0,0,0,-1*e[2]*t[2],-1*e[2]*t[3]],[0,0,0,t[2],t[3],1,-1*e[3]*t[2],-1*e[3]*t[3]],[t[4],t[5],1,0,0,0,-1*e[4]*t[4],-1*e[4]*t[5]],[0,0,0,t[4],t[5],1,-1*e[5]*t[4],-1*e[5]*t[5]],[t[6],t[7],1,0,0,0,-1*e[6]*t[6],-1*e[6]*t[7]],[0,0,0,t[6],t[7],1,-1*e[7]*t[6],-1*e[7]*t[7]]],a=e;try{o=i.inv(i.dotMMsmall(i.transpose(s),s))}catch(t){return[1,0,0,0,1,0,0,0]}for(var h,l=i.dotMMsmall(o,i.transpose(s)),u=i.dotMV(l,a),c=0;c<u.length;c++)u[c]=(h=u[c],Math.round(1e10*h)/1e10);return u[8]=1,u}function o(t,e){return"undefined"!=typeof window&&window===this||void 0===this?new o(t,e):(this.srcPts=t,this.dstPts=e,this.coeffs=r(this.srcPts,this.dstPts,!1),this.coeffsInv=r(this.srcPts,this.dstPts,!0),this)}o.prototype={transform:function(t,e){var n=[];return n[0]=(this.coeffs[0]*t+this.coeffs[1]*e+this.coeffs[2])/(this.coeffs[6]*t+this.coeffs[7]*e+1),n[1]=(this.coeffs[3]*t+this.coeffs[4]*e+this.coeffs[5])/(this.coeffs[6]*t+this.coeffs[7]*e+1),n},transformInverse:function(t,e){var n=[];return n[0]=(this.coeffsInv[0]*t+this.coeffsInv[1]*e+this.coeffsInv[2])/(this.coeffsInv[6]*t+this.coeffsInv[7]*e+1),n[1]=(this.coeffsInv[3]*t+this.coeffsInv[4]*e+this.coeffsInv[5])/(this.coeffsInv[6]*t+this.coeffsInv[7]*e+1),n}};const s=o;function a(t,e){var n=88*(1+t)+80*(e?e[0].charCodeAt(0):2);colorMode(HSB,255);var i=color(n%255,255,255);return colorMode(RGB,255),i}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=constrain(t,.01,100);var n=.5+.5*sin(frameCount/(60*t)*2*PI+e);return n}function l(){return drawingContext instanceof WebGLRenderingContext}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var f=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;u(this,t),this.x=n,this.y=i,this.r=r,this.isControlPoint=!1,this.parent=e,this.isSelected=!1,this.xStartDrag=this.x,this.yStartDrag=this.y,this.clickX=0,this.clickY=0,this.col=color(0,255,255)}var e,n;return e=t,n=[{key:"isMouseOver",value:function(){var t=mouseX,e=mouseY;return l()&&(t-=width/2,e-=height/2),dist(t,e,this.x+this.parent.x,this.y+this.parent.y)<this.r}},{key:"set",value:function(t){this.x=t.x,this.y=t.y}},{key:"startDrag",value:function(){this.xStartDrag=this.x,this.yStartDrag=this.y,this.clickX=mouseX,this.clickY=mouseY}},{key:"moveToMouse",value:function(){this.x=mouseX-width/2,this.y=mouseY-height/2}},{key:"moveTo",value:function(){"LINE"===this.parent.type?this.moveToMouse():(this.x=this.xStartDrag+mouseX-this.clickX,this.y=this.yStartDrag+mouseY-this.clickY)}},{key:"move",value:function(t,e){this.x+=t,this.y+=e}},{key:"setControlPoint",value:function(t){this.isControlPoint=t}},{key:"interpolateBetween",value:function(t,e,n){this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.col,e=t;isSelected(this)?e=color("red"):this.isMouseOver()&&(e="white"),push(),translate(0,0,5),stroke(e),strokeWeight(2),noFill(),ellipse(this.x,this.y,this.r),fill(e),ellipse(this.x,this.y,this.r/2),isSelected(this)&&(fill("white"),ellipse(this.x,this.y,5)),pop()}}],n&&c(e.prototype,n),t}();const y=f;function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function d(t,e,n){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}},d(t,e,n||t)}function m(t,e){return m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},m(t,e)}function g(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}const k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(s,t);var e,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=b(i);if(r){var n=b(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return g(this,t)});function s(t,e,n,i,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(a=o.call(this,t,e,n)).u=i,a.v=r,a}return e=s,(n=[{key:"set",value:function(t){d(b(s.prototype),"set",this).call(this,t),this.u=t.u,this.v=t.v}},{key:"moveTo",value:function(){d(b(s.prototype),"moveTo",this).call(this),this.parent.calculateMesh()}},{key:"move",value:function(t,e){this.x+=t,this.y+=e,this.parent.calculateMesh()}},{key:"interpolateTo",value:function(t,e){var n=this.x+(t.x-this.x)*e,i=this.y+(t.y-this.y)*e;return new s(this.parent,n,i,0,0)}}])&&v(e.prototype,n),s}(y);var x=function t(e,n,i,r,o,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),p5.Graphics.call(this,n,i,WEBGL,s),this.id=e,this.res=Math.floor(r),this.type=o,this.x=0,this.y=0,this.clickX=0,this.clickY=0,this.xStartDrag=this.x,this.yStartDrag=this.y,this.gridColor=color(200),this.controlPointColor=color(255,0,255)};function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function P(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function C(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function O(t,e){return O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},O(t,e)}function T(t,e){if(e&&("object"===w(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},M(t)}x.prototype=Object.create(p5.Graphics.prototype);const j=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(s,t);var e,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=M(i);if(r){var n=M(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return T(this,t)});function s(t,e,n,i,r,h){var l;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(l=o.call(this,t,e,n,i,r,h)).perspT=null,l.initMesh(),l.calculateMesh(),l.controlPointColor=a(l.id,l.type),l}return e=s,(n=[{key:"render",value:function(){}},{key:"isMouseOver",value:function(){}},{key:"calculateMesh",value:function(){}},{key:"initMesh",value:function(){this.mesh=[];for(var t=0;t<this.res;t++)for(var e=0;e<this.res;e++){var n=Math.floor(map(e,0,this.res,0,this.width)),i=Math.floor(map(t,0,this.res,0,this.height)),r=map(e,0,this.res,0,1),o=map(t,0,this.res,0,1);this.mesh[t*this.res+e]=new k(this,n,i,r,o)}this.TL=0,this.TR=this.res-1+0,this.BL=0+(this.res-1)*this.res,this.BR=this.res-1+(this.res-1)*this.res,this.mesh[this.TL].setControlPoint(!0),this.mesh[this.TR].setControlPoint(!0),this.mesh[this.BR].setControlPoint(!0),this.mesh[this.BL].setControlPoint(!0),this.controlPoints=[],this.controlPoints.push(this.mesh[this.TL]),this.controlPoints.push(this.mesh[this.TR]),this.controlPoints.push(this.mesh[this.BR]),this.controlPoints.push(this.mesh[this.BL])}},{key:"load",value:function(t){var e=t.x,n=t.y,i=t.points;this.x=e,this.y=n;var r,o=P(i);try{for(o.s();!(r=o.n()).done;){var s=r.value,a=this.mesh[s.i];a.x=s.x,a.y=s.y,a.u=s.u,a.v=s.v}}catch(t){o.e(t)}finally{o.f()}this.calculateMesh()}},{key:"getJson",value:function(){var t={};t.id=this.id,t.res=this.res,t.x=this.x,t.y=this.y,t.w=this.w,t.h=this.h,t.type=this.type,t.points=[];for(var e=0;e<this.mesh.length;e++)if(this.mesh[e].isControlPoint){var n={};n.i=e,n.x=this.mesh[e].x,n.y=this.mesh[e].y,n.u=this.mesh[e].u,n.v=this.mesh[e].v,t.points.push(n)}return t}},{key:"isEqual",value:function(t){return t.id===this.id&&t.type===this.type}},{key:"getControlPoints",value:function(){return this.controlPoints}},{key:"select",value:function(){var t=this.isMouseOverControlPoints();return t?(t.startDrag(),t):this.isMouseOver()?(this.startDrag(),this):null}},{key:"startDrag",value:function(){this.xStartDrag=this.x,this.yStartDrag=this.y,this.clickX=mouseX,this.clickY=mouseY}},{key:"moveTo",value:function(){this.x=this.xStartDrag+mouseX-this.clickX,this.y=this.yStartDrag+mouseY-this.clickY}},{key:"move",value:function(t,e){this.x+=t,this.y+=e}},{key:"isMouseOverControlPoints",value:function(){var t,e=P(this.controlPoints);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(n.isMouseOver())return n}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isPointInTriangle",value:function(t,e,n,i,r){var o=createVector(r.x-n.x,r.y-n.y),s=createVector(i.x-n.x,i.y-n.y),a=createVector(t-n.x,e-n.y),h=o.dot(o),l=s.dot(o),u=a.dot(o),c=s.dot(s),f=a.dot(s),y=1/(h*c-l*l),p=(c*u-l*f)*y,v=(h*f-l*u)*y;return p>0&&v>0&&p+v<1}},{key:"displayControlPoints",value:function(){push(),translate(this.x,this.y);var t,e=P(this.controlPoints);try{for(e.s();!(t=e.n()).done;)t.value.display(this.controlPointColor)}catch(t){e.e(t)}finally{e.f()}pop()}},{key:"displayOutline",value:function(){strokeWeight(3),stroke(this.controlPointColor),fill(red(this.controlPointColor),green(this.controlPointColor),blue(this.controlPointColor),50),beginShape();var t,e=P(this.controlPoints);try{for(e.s();!(t=e.n()).done;){var n=t.value;vertex(n.x,n.y)}}catch(t){e.e(t)}finally{e.f()}endShape(CLOSE)}},{key:"beginDrawing",value:function(){this.push()}},{key:"endDrawing",value:function(){this.pop()}},{key:"getTransformedCursor",value:function(t,e){var n=this.perspT(t-this.x,e-this.y);return createVector(n[0],n[1])}},{key:"getTransformedMouse",value:function(){return getTransformedCursor(mouseX,mouseY)}},{key:"cross2",value:function(t,e,n,i){return t*i-e*n}}])&&C(e.prototype,n),s}(x);function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function I(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function E(t,e){return E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},E(t,e)}function D(t,e){if(e&&("object"===R(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}var _=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(a,t);var e,n,i,r,o=(i=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=A(i);if(r){var n=A(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return D(this,t)});function a(t,e,n,i,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,t,e,n,i,"QUAD",r)}return e=a,n=[{key:"isMouseOver",value:function(){var t=mouseX-width/2,e=mouseY-height/2;return!(!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.TL],this.mesh[this.TR],this.mesh[this.BL])&&!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.BL],this.mesh[this.TR],this.mesh[this.BR]))}},{key:"calculateMesh",value:function(){var t=[0,0,this.width,0,this.width,this.height,0,this.height],e=[this.mesh[this.TL].x,this.mesh[this.TL].y,this.mesh[this.TR].x,this.mesh[this.TR].y,this.mesh[this.BR].x,this.mesh[this.BR].y,this.mesh[this.BL].x,this.mesh[this.BL].y];this.perspT=s(t,e);for(var n=this.width/(this.res-1),i=this.height/(this.res-1),r=0;r<this.mesh.length;r++)if(this.TL!=r&&this.BR!=r&&this.TR!=r&&this.BL!=r){var o=r%this.res,a=Math.floor(r/this.res);o*=n,a*=i;var h=this.perspT.transform(o,a);this.mesh[r].x=h[0],this.mesh[r].y=h[1]}}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.height;push(),translate(this.x,this.y),texture(this),beginShape(TRIANGLES);for(var r=0;r<this.res-1;r++)for(var o=0;o<this.res-1;o++)this.getQuadTriangles(r,o,t,e,n,i);endShape(CLOSE),isCalibratingMapper()&&(translate(0,0,3),this.displayOutline(),this.displayGrid()),pop()}},{key:"displayGrid",value:function(){strokeWeight(2),stroke(this.controlPointColor),fill(red(this.controlPointColor),green(this.controlPointColor),blue(this.controlPointColor),50),beginShape(TRIANGLES);for(var t=0;t<this.res-1;t++)for(var e=0;e<this.res-1;e++)this.getQuadTrianglesOutline(t,e);endShape(CLOSE)}},{key:"getQuadTriangles",value:function(t,e,n,i,r,o){var s=this.mesh[t+e*this.res];this.getVertexUV(s,n,i,r,o),s=this.mesh[t+1+e*this.res],this.getVertexUV(s,n,i,r,o),s=this.mesh[t+1+(e+1)*this.res],this.getVertexUV(s,n,i,r,o),this.getVertexUV(s,n,i,r,o),s=this.mesh[t+(e+1)*this.res],this.getVertexUV(s,n,i,r,o),s=this.mesh[t+e*this.res],this.getVertexUV(s,n,i,r,o)}},{key:"getQuadTrianglesOutline",value:function(t,e){var n=this.mesh[t+e*this.res];vertex(n.x,n.y),n=this.mesh[t+1+e*this.res],vertex(n.x,n.y),n=this.mesh[t+1+(e+1)*this.res],vertex(n.x,n.y),vertex(n.x,n.y),n=this.mesh[t+(e+1)*this.res],vertex(n.x,n.y),n=this.mesh[t+e*this.res],vertex(n.x,n.y)}},{key:"getVertexUV",value:function(t,e,n,i,r){var o=map(t.u,0,1,e,e+i),s=map(t.v,0,1,n,n+r);vertex(t.x,t.y,o,s)}}],n&&I(e.prototype,n),a}(j);const B=_;function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function V(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function X(t,e){return X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},X(t,e)}function Y(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},W(t)}const U=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(s,t);var e,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=W(i);if(r){var n=W(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Y(this,t)});function s(t,e,n,i,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(a=o.call(this,t,e,n,i,"TRI",r)).setTriMesh(),a}return e=s,(n=[{key:"isMouseOver",value:function(){var t=mouseX-width/2,e=mouseY-height/2;return!!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.TP],this.mesh[this.BL],this.mesh[this.BR])}},{key:"Barycentric",value:function(t,e,n,i,r,o,s){var a=n.sub(e),h=i.sub(e),l=t.sub(e);a.dot(a),a.dot(h),h.dot(h),l.dot(a),l.dot(h)}},{key:"setTriMesh",value:function(){this.TP=Math.floor(this.res/2)-1,this.mesh[this.TP].setControlPoint(!0),this.mesh[this.TL].setControlPoint(!1),this.mesh[this.TR].setControlPoint(!1),this.controlPoints=[],this.controlPoints.push(this.mesh[this.TP],this.mesh[this.BL],this.mesh[this.BR])}},{key:"render",value:function(){push(),translate(this.x,this.y),noStroke(),fill(0),texture(this),beginShape();var t=0,e=this.height;vertex(this.mesh[this.BL].x,this.mesh[this.BL].y,t,e),t=this.width/2,e=0,vertex(this.mesh[this.TP].x,this.mesh[this.TP].y,t,e),t=this.width,e=this.height,vertex(this.mesh[this.BR].x,this.mesh[this.BR].y,t,e),endShape(CLOSE),isCalibratingMapper()&&this.displayOutline(),pop()}}])&&V(e.prototype,n),s}(j);function G(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var J=function(){function t(e,n,i,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=o,this.x=0,this.y=0,this.clickX=0,this.clickY=0,this.type="LINE",this.lineW=10,this.lastChecked=0,this.lineC=color(255),this.highlightColor=color(0,255,0),this.controlPointColor=a(this.id,this.type),this.p0=new y(this,e,n,20),this.p1=new y(this,i,r,20),this.controlCol=a(),this.leftToRight(),this.ang=atan2(this.p0.y-this.p1.y,this.p0.x-this.p1.x),this.ang>PI/2&&(this.ang-=2*PI)}var e,n;return e=t,n=[{key:"load",value:function(t){this.p0.x=t.x0,this.p0.y=t.y0,this.p1.x=t.x1,this.p1.y=t.y1}},{key:"getJson",value:function(){var t={};return t.id=this.id,t.x0=this.p0.x,t.y0=this.p0.y,t.x1=this.p1.x,t.y1=this.p1.y,t}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lineC;strokeWeight(this.lineW),stroke(t),line(this.p0.x,this.p0.y,this.p1.x,this.p1.y),this.drawEndCaps(this.p0,this.p1,t,t)}},{key:"displayCenterPulse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC,n=(this.p0.x+this.p1.x)/2,i=(this.p0.y+this.p1.y)/2,r=map(t,0,1,n,this.p0.x),o=map(t,0,1,n,this.p1.x),s=map(t,0,1,i,this.p0.y),a=map(t,0,1,i,this.p1.y);strokeWeight(this.lineW),stroke(e),line(r,s,o,a),this.drawEndCaps({x:r,y:s},{x:o,y:a},e,e)}},{key:"displayPercent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC,n=t,i=createVector(this.p0.x,this.p0.y),r=createVector(this.p1.x,this.p1.y),o=p5.Vector.lerp(i,r,n);strokeWeight(this.lineW),stroke(e),line(this.p0.x,this.p0.y,o.x,o.y),this.drawEndCaps(i,o,e,e)}},{key:"displayPercentWidth",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC;t=constrain(t,0,1);var n=map(t,0,1,0,10);strokeWeight(n),stroke(e),line(this.p0.x,this.p0.y,this.p1.x,this.p1.y),this.drawEndCaps(this.p0,this.p1,e,e,n)}},{key:"displayNone",value:function(){this.display(color(0))}},{key:"displayRainbowCycle",value:function(){colorMode(HSB,255);var t=color(frameCount%255,255,255);this.display(t),colorMode(RGB,255)}},{key:"displayGradientLine",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n+=i,n%=1;for(var r=1/height,o=0;o<1;o+=r){var s=(o/2+n)%1,a=this.get2CycleColor(t,e,s);this.displaySegment(o,r,a)}}},{key:"displayCalibration",value:function(){var t=color(0,255,0);this.display(t)}},{key:"displayControlPoints",value:function(){this.p0.display(this.controlPointColor),this.p1.display(this.controlPointColor)}},{key:"drawEndCaps",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.lineC,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.lineC,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.lineW;noStroke(),dist(t.x,t.y,e.x,e.y)>1&&(fill(n),ellipse(t.x,t.y,r,r),fill(i),ellipse(e.x,e.y,r,r))}},{key:"displaySegment",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.lineC;strokeWeight(this.lineW),stroke(n);var i=createVector(this.p0.x,this.p0.y),r=createVector(this.p1.x,this.p1.y),o=p5.Vector.lerp(i,r,t),s=p5.Vector.lerp(o,r,t+e);line(o.x,o.y,s.x,s.y),this.drawEndCaps(o,s,n,n)}},{key:"get2CycleColor",value:function(t,e,n){return n=constrain(n,0,1),(n*=2)<1?lerpColor(t,e,n):(n=map(n,1,2,0,1),lerpColor(e,t,n))}},{key:"get3CycleColor",value:function(t,e,n){return n=constrain(n,0,1),(n*=3)<1?lerpColor(t,e,n):n<2?(n=map(n,1,2,1,0),lerpColor(c3,e,n)):(n=map(n,2,3,1,0),lerpColor(t,c3,n))}},{key:"getPointHighlight",value:function(t){colorMode(RGB,255),this.isMouseOverPoint(t)?stroke(0,255,0):stroke(255,0,0)}},{key:"isMouseOverPoint",value:function(t){return dist(t.x,t.y,mouseX-width/2,mouseY-height/2)<t.r}},{key:"isMouseOver",value:function(){var t=this.p0.x,e=this.p0.y,n=this.p1.x,i=this.p1.y,r=mouseX-width/2,o=mouseY-height/2,s=dist(r,o,t,e),a=dist(r,o,n,i),h=dist(t,e,n,i);return s+a>=h-.2&&s+a<=h+.2}},{key:"select",value:function(){var t=mouseX-width/2,e=mouseY-height/2;return dist(this.p0.x,this.p0.y,t,e)<this.p0.r?this.p0:dist(this.p1.x,this.p1.y,t,e)<this.p1.r?this.p1:null}},{key:"leftToRight",value:function(){if(this.p0.x>this.p1.x){var t=createVector(this.p0.x,this.p0.y);this.p0.set(this.p1),this.p1.set(t)}}},{key:"rightToLeft",value:function(){if(this.p0.x<this.p1.x){var t=createVector(this.p0.x,this.p0.y);this.p0.set(this.p1),this.p1.set(t)}}}],n&&G(e.prototype,n),t}();const F=J;function N(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var H=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.x=0,this.y=0,this.clickX=0,this.clickY=0,this.xStartDrag=this.x,this.yStartDrag=this.y,this.type="MASK",this.controlPointColor=a(this.id,this.type),this.points=[];for(var i=0;i<n;i++){var r=200*cos(i/n*2*PI),o=200*sin(i/n*2*PI);l()||(r+=width/2,o+=height/2);var s=new y(this,r,o);s.isControlPoint=!0,this.points.push(s)}}var e,n;return e=t,n=[{key:"setPoints",value:function(t){this.points=[];var e,n=N(t);try{for(n.s();!(e=n.n()).done;){var i=e.value,r=new y(this,i.x,i.y);r.isControlPoint=!0,this.points.push(r)}}catch(t){n.e(t)}finally{n.f()}}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:color(0);push(),translate(this.x,this.y,1),noStroke(),isCalibratingMapper()?fill(this.controlPointColor):(fill(t),stroke(t)),beginShape();var e,n=N(this.points);try{for(n.s();!(e=n.n()).done;){var i=e.value;vertex(i.x,i.y)}}catch(t){n.e(t)}finally{n.f()}endShape(),pop()}},{key:"displayControlPoints",value:function(){push(),translate(this.x,this.y,2);var t,e=N(this.points);try{for(e.s();!(t=e.n()).done;)t.value.display(this.controlPointColor)}catch(t){e.e(t)}finally{e.f()}pop()}},{key:"isMouseOver",value:function(){var t={x:mouseX,y:mouseY};return l()&&(t.x-=width/2,t.y-=height/2),function(t,e,n){for(var i=t.x,r=t.y,o=!1,s=0,a=e.length-1;s<e.length;a=s++){var h=e[s].x+n.x,l=e[s].y+n.y,u=e[a].x+n.x,c=e[a].y+n.y;l>r!=c>r&&i<(u-h)*(r-l)/(c-l)+h&&(o=!o)}return o}(t,this.points,{x:this.x,y:this.y})}},{key:"load",value:function(t){var e=t.x,n=t.y,i=t.points;this.x=e,this.y=n;var r,o=N(i);try{for(o.s();!(r=o.n()).done;){var s=r.value,a=this.points[s.i];a.x=s.x,a.y=s.y}}catch(t){o.e(t)}finally{o.f()}}},{key:"getJson",value:function(){var t={};t.id=this.id,t.x=this.x,t.y=this.y,t.type=this.type,t.points=[];for(var e=0;e<this.points.length;e++){var n={};n.i=e,n.x=this.points[e].x,n.y=this.points[e].y,t.points.push(n)}return t}},{key:"isEqual",value:function(t){return t.type===this.type&&t.id===this.id}},{key:"select",value:function(){var t,e=N(this.points);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(n.isMouseOver())return n.startDrag(),n}}catch(t){e.e(t)}finally{e.f()}return this.isMouseOver()?(this.startDrag(),this):null}},{key:"startDrag",value:function(){this.xStartDrag=this.x,this.yStartDrag=this.y,this.clickX=mouseX,this.clickY=mouseY}},{key:"moveTo",value:function(){this.x=this.xStartDrag+mouseX-this.clickX,this.y=this.yStartDrag+mouseY-this.clickY}},{key:"move",value:function(t,e){this.x+=t,this.y+=e}}],n&&q(e.prototype,n),t}();const $=H;function K(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Z(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function z(t){return function(t){if(Array.isArray(t))return tt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Z(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(t,e){if(t){if("string"==typeof t)return tt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tt(t,e):void 0}}function tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function et(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var nt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.surfaces=[],this.lines=[],this.masks=[],this.dragged=null,this.selected=null,this.calibrationMode=!1,this.pInst=null,this.mousePressedState=!1,this.keyPressedForFrames=0}var e,n;return e=t,n=[{key:"createQuadMap",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,i=new B(this.surfaces.length,t,e,n,this.pInst);return this.surfaces.push(i),i}},{key:"createTriMap",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,i=new U(this.surfaces.length,t,e,n,this.pInst);return this.surfaces.push(i),i}},{key:"createLineMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;0==t&&0==e&&0==n&&0==i&&(n=200,e=30*this.lines.length,i=30*this.lines.length);var r=new F(t,e,n,i,this.lines.length);return this.lines.push(r),r}},{key:"createMaskMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;t<3&&(t=3);var e=new $(this.masks.length,t);return this.masks.push(e),e}},{key:"onClick",value:function(){if(this.calibrationMode){var t=[].concat(z(this.masks),z(this.lines.reverse()),z(this.surfaces.reverse())).find((function(t){return!!t.select()}));if(t)return this.dragged=t.select(),void(this.selected=t.select());this.selected=null}}},{key:"onDrag",value:function(){null!=this.dragged&&this.dragged.moveTo()}},{key:"onRelease",value:function(){this.dragged=null}},{key:"isDragging",value:function(t){return this.dragged===t}},{key:"isSelected",value:function(t){return this.selected===t}},{key:"updateEvents",value:function(){if(this.selected){this.keyPressedForFrames++;var t=this.keyPressedForFrames<10&&this.keyPressedForFrames>1?0:1;keyIsDown(LEFT_ARROW)?this.selected.move(-t,0):keyIsDown(RIGHT_ARROW)?this.selected.move(t,0):keyIsDown(UP_ARROW)?this.selected.move(0,-t):keyIsDown(DOWN_ARROW)?this.selected.move(0,t):this.keyPressedForFrames=0}mouseIsPressed?this.pMousePressed?this.onDrag():this.onClick():this.pMousePressed&&this.onRelease(),this.pMousePressed=mouseIsPressed}},{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"maps/map.json";console.log("loading json file: ".concat(t));var e=this,n=function(e){return console.log("error loading ".concat(t),e)};loadJSON("".concat(t),e.loadedJson.bind(e),n)}},{key:"loadedJson",value:function(t){t.masks&&this.loadMasks(t),t.surfaces&&this.loadSurfaces(t),t.lines&&this.loadLines(t)}},{key:"loadMasks",value:function(t){var e=t.masks;e.length!==this.masks.length&&console.warn("json calibration file has ".concat(e.length," masks but there are ").concat(this.masks.length," masks in memory (check sketch.js for # of mask objects)"));for(var n=0;n<e.length&&n<this.masks.length;){var i=this.masks[n];i.isEqual(this.masks[n])?i.load(e[n]):console.warn("mismatch between calibration mask types / ids"),n++}}},{key:"loadSurfaces",value:function(t){var e=t.surfaces;e.length!==this.surfaces.length&&console.warn("json calibration file has ".concat(e.length," surface maps but there are ").concat(this.surfaces.length," surface maps in memory (check sketch.js for # of map objects)"));for(var n=e.filter((function(t){return"TRI"===t.type})),i=e.filter((function(t){return"QUAD"===t.type})),r=this.surfaces.filter((function(t){return"TRI"===t.type})),o=this.surfaces.filter((function(t){return"QUAD"===t.type})),s=0;s<n.length&&s<r.length;){var a=r[s];a.isEqual(r[s])?a.load(n[s]):console.warn("mismatch between calibration surface types / ids"),s++}for(s=0;s<i.length&&s<o.length;){var h=o[s];h.isEqual(o[s])?h.load(i[s]):console.warn("mismatch between calibration surface types / ids"),s++}}},{key:"loadLines",value:function(t){var e=t.lines;e.length!==this.lines.length&&console.warn("json calibration file has ".concat(e.length," line maps but there are ").concat(this.lines.length," line maps in memory"));for(var n=0;n<e.length&&n<this.lines.length;)this.lines[n].load(e[n]),n++}},{key:"save",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"map.json";console.log("saving all mapped surfaces to json...");var e,n={surfaces:[],lines:[],masks:[]},i=K(this.masks);try{for(i.s();!(e=i.n()).done;){var r=e.value;n.masks.push(r.getJson())}}catch(t){i.e(t)}finally{i.f()}var o,s=K(this.surfaces);try{for(s.s();!(o=s.n()).done;){var a=o.value;n.surfaces.push(a.getJson())}}catch(t){s.e(t)}finally{s.f()}var h,l=K(this.lines);try{for(l.s();!(h=l.n()).done;){var u=h.value;n.lines.push(u.getJson())}}catch(t){l.e(t)}finally{l.f()}saveJSON(n,"".concat(t))}},{key:"export",value:function(){var t,e={surfaces:[],lines:[],masks:[]},n=K(this.masks);try{for(n.s();!(t=n.n()).done;){var i=t.value;e.masks.push(i.getJson())}}catch(t){n.e(t)}finally{n.f()}var r,o=K(this.surfaces);try{for(o.s();!(r=o.n()).done;){var s=r.value;e.surfaces.push(s.getJson())}}catch(t){o.e(t)}finally{o.f()}var a,h=K(this.lines);try{for(h.s();!(a=h.n()).done;){var l=a.value;e.lines.push(l.getJson())}}catch(t){h.e(t)}finally{h.f()}return e}},{key:"startCalibration",value:function(){this.calibrationMode=!0}},{key:"stopCalibration",value:function(){this.selected=null,this.calibrationMode=!1}},{key:"toggleCalibration",value:function(){return this.calibrationMode?this.stopCalibration():this.startCalibration()}},{key:"beginSurfaces",value:function(){var t,e=K(this.surfaces);try{for(e.s();!(t=e.n()).done;)t.value.beginDrawing()}catch(t){e.e(t)}finally{e.f()}}},{key:"endSurfaces",value:function(){var t,e=K(this.surfaces);try{for(e.s();!(t=e.n()).done;)t.value.endDrawing()}catch(t){e.e(t)}finally{e.f()}}},{key:"renderSurfaces",value:function(){this.endSurfaces();var t,e=K(this.surfaces);try{for(e.s();!(t=e.n()).done;)t.value.render()}catch(t){e.e(t)}finally{e.f()}}},{key:"display",value:function(){this.renderSurfaces(),this.displayControlPoints()}},{key:"displayControlPoints",value:function(){if(this.calibrationMode){var t,e=K(this.masks);try{for(e.s();!(t=e.n()).done;)t.value.displayControlPoints()}catch(t){e.e(t)}finally{e.f()}var n,i=K(this.surfaces);try{for(i.s();!(n=i.n()).done;)n.value.displayControlPoints()}catch(t){i.e(t)}finally{i.f()}var r,o=K(this.lines);try{for(o.s();!(r=o.n()).done;){var s=r.value;s.displayCalibration(),s.displayControlPoints()}}catch(t){o.e(t)}finally{o.f()}}}},{key:"getOscillator",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h(t,e)}}],n&&et(e.prototype,n),t}(),it=new nt;return p5.prototype.createProjectionMapper=function(t){return it.pInst=this,it},p5.prototype.isCalibratingMapper=function(){return it.calibrationMode},p5.prototype.isDragging=function(t){return it.isDragging(t)},p5.prototype.isSelected=function(t){return it.isSelected(t)},p5.prototype.registerMethod("pre",(function(){return it.beginSurfaces()})),p5.prototype.registerMethod("post",(function(){return it.display()})),p5.prototype.registerMethod("post",(function(){return it.updateEvents()})),t})()}));